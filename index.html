<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Whac-A-Mole</title>

<style>
  body { 
    font-family: sans-serif; 
    text-align: center; 
    margin: 0;
    background: #f5f5f5;
  }

  h1 { 
    margin-top: 0.7rem; 
  }

  canvas {
    background: #90d070;
    border: 6px solid #654321;
    border-radius: 8px;
    cursor: url("hammer.png") 6 4, auto;
    margin-top: 1rem;
  }

  #hud { 
    margin-top: 0.5rem; 
    font-size: 1.3rem; 
  }

  #gameOver { 
    margin-top: 0.8rem; 
    font-size: 1.8rem; 
    color: #b30000; 
    display: none; 
  }

  #popup {
    position: fixed;
    right: 1.2rem; 
    top: 50%;
    transform: translateY(-50%);
    padding: 0.6rem 1rem;
    background: #ffe6f8;
    color: #c1006f;
    border: 3px solid #c1006f;
    border-radius: 10px;
    font-weight: bold;
    font-size: 1rem;
    box-shadow: 0 0 8px rgba(0,0,0,.25);
    display: none;
    pointer-events: none;
  }

  #startScreen {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.85);
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    z-index: 1000;
  }

  #startScreen h2 {
    color: #fff;
    font-size: 3rem;
    margin-bottom: 1rem;
  }

  #startScreen p {
    color: #ddd;
    font-size: 1.2rem;
    margin-bottom: 2rem;
  }

  .btn {
    padding: 1rem 2.5rem;
    font-size: 1.5rem;
    font-weight: bold;
    background: #4CAF50;
    color: white;
    border: none;
    border-radius: 10px;
    cursor: pointer;
    box-shadow: 0 4px 8px rgba(0,0,0,.3);
    transition: all 0.3s;
  }

  .btn:hover {
    background: #45a049;
    transform: translateY(-2px);
    box-shadow: 0 6px 12px rgba(0,0,0,.4);
  }

  .btn:active {
    transform: translateY(0);
  }

  #replayBtn {
    margin-top: 1rem;
    display: none;
    padding: 0.8rem 2rem;
    font-size: 1.2rem;
  }

  .point-popup {
    position: absolute;
    color: #FFD700;
    font-size: 2rem;
    font-weight: bold;
    pointer-events: none;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
    animation: pointFloat 1s ease-out forwards;
  }

  @keyframes pointFloat {
    0% {
      opacity: 1;
      transform: translate(-50%, 0) scale(1);
    }
    100% {
      opacity: 0;
      transform: translate(-50%, -60px) scale(1.5);
    }
  }
</style>
</head>

<body>

<div id="startScreen">
  <h2>ðŸ”¨ Whac-A-Mole ðŸ”¨</h2>
  <p>Hit the moles, avoid the eagles!<br>You have 30 seconds. Good luck!</p>
  <button class="btn" onclick="startGame()">START GAME</button>
</div>

<h1>Whac-A-Mole</h1>

<canvas id="game" width="600" height="400"></canvas>

<div id="hud">
  <span id="score">Score : 0</span> |
  <span id="timer">Time : 30</span>
</div>

<div id="gameOver"></div>
<button id="replayBtn" class="btn" onclick="replayGame()">PLAY AGAIN</button>
<div id="popup">Oh no, don't hit the soaring eagle!</div>


<script>
/* CONFIG */
const HOLES       = 6;
const R_BASE      = 45;
const R_MOLE      = R_BASE + 12;
const R_BEN       = R_MOLE + 12;
const SHOW_TIME   = 900;
const RISE_TIME   = 140;
const ROUND_TIME  = 30;
const BEN_FREQ    = 5;
const POPUP_TIME  = 1300;

/* ELEMENTS */
const canvas   = document.getElementById('game');
const ctx      = canvas.getContext('2d');
const scoreEl  = document.getElementById('score');
const timerEl  = document.getElementById('timer');
const gameOver = document.getElementById('gameOver');
const popup    = document.getElementById('popup');
const startScreen = document.getElementById('startScreen');
const replayBtn = document.getElementById('replayBtn');

/* IMAGES */
const moleImg  = new Image();
moleImg.src    = "mole.png";

const benImg   = new Image();
benImg.src     = "ben.png";

/* SOUND (optional) */
// const clap = new Audio("clap.mp3");

/* STATE */
let score = 0;
let spawnCount = 0;
let timeLeft = ROUND_TIME;
let playing = false;
let gameStarted = false;
let spawnHandle, timerHandle;

/* HOLES SETUP */
let holes = Array.from({length: HOLES}, (_, i) => ({
  x: (i % 3) * 200 + 100,
  y: i < 3 ? 120 : 300,
  state: 0,
  showing: false,
  ben: false,
  timer: 0
}));

/* HELPERS */
const updateHUD = () => {
  scoreEl.textContent = `Score : ${score}`;
  timerEl.textContent = `Time : ${timeLeft}`;
};

const showPopup = () => {
  popup.style.display = "block";
  setTimeout(() => popup.style.display = "none", POPUP_TIME);
};

const showPointPopup = (x, y, points) => {
  const rect = canvas.getBoundingClientRect();
  const pointDiv = document.createElement('div');
  pointDiv.className = 'point-popup';
  pointDiv.textContent = `+${points}`;
  pointDiv.style.left = (rect.left + x) + 'px';
  pointDiv.style.top = (rect.top + y) + 'px';
  document.body.appendChild(pointDiv);
  
  setTimeout(() => pointDiv.remove(), 1000);
};

const endGame = () => {
  playing = false;
  clearInterval(spawnHandle);
  clearInterval(timerHandle);
  gameOver.textContent = `Time's up! Final score: ${score}`;
  gameOver.style.display = "block";
  replayBtn.style.display = "inline-block";
};

const spawn = () => {
  const h = holes[Math.floor(Math.random() * HOLES)];
  if (h.showing) return;

  spawnCount++;
  h.ben     = (spawnCount % BEN_FREQ === 0);
  h.showing = true;
  h.timer   = SHOW_TIME;
  h.state   = 0;
};

const addHit = (isBen, x, y) => {
  if (isBen) {
    showPopup();
    score = 0;
  } else {
    score++;
    showPointPopup(x, y, 1);
    // clap.play();  // optional
  }
  updateHUD();
};

/* CLICK HANDLER */
canvas.addEventListener('click', e => {
  if (!playing) return;

  const rect = canvas.getBoundingClientRect();
  const mx = e.clientX - rect.left;
  const my = e.clientY - rect.top;

  holes.forEach(h => {
    if (!h.showing) return;

    const dy = R_BASE - h.state * R_BASE * 2;
    const cx = h.x;
    const cy = h.y - dy;
    const radius = h.ben ? R_BEN : R_MOLE;

    if (Math.hypot(mx - cx, my - cy) < radius) {
      addHit(h.ben, mx, my);
      h.showing = false;
    }
  });
});

/* ANIMATION LOOP */
let last = performance.now();
const tick = now => {
  const dt = now - last;
  last = now;

  ctx.clearRect(0, 0, canvas.width, canvas.height);

  ctx.fillStyle = "#6ca940";
  ctx.fillRect(0, canvas.height / 2, canvas.width, canvas.height / 2);

  holes.forEach(h => {
    if (h.showing) {
      h.state = Math.min(1, h.state + dt / RISE_TIME);
      h.timer -= dt;
      if (h.timer <= 0) h.showing = false;
    } else {
      h.state = Math.max(0, h.state - dt / RISE_TIME);
    }

    ctx.beginPath();
    ctx.arc(h.x, h.y, R_BEN, 0, Math.PI * 2);
    ctx.fillStyle = "#3d2d1e";
    ctx.fill();

    if (h.state > 0) {
      const img = h.ben ? benImg : moleImg;
      const r = h.ben ? R_BEN : R_MOLE;
      const off = r * 2 * (1 - h.state);
      ctx.drawImage(img, h.x - r, h.y - r - 10 + off, r * 2, r * 2);
    }
  });

  if (playing || !gameStarted) requestAnimationFrame(tick);
};

/* SAFE IMAGE LOADING */
function loadImage(img) {
  return new Promise(resolve => {
    if (img.complete) return resolve();
    img.onload = resolve;
  });
}

/* GAME CONTROLS */
function startGame() {
  startScreen.style.display = 'none';
  gameStarted = true;
  playing = true;
  score = 0;
  spawnCount = 0;
  timeLeft = ROUND_TIME;
  
  holes.forEach(h => {
    h.state = 0;
    h.showing = false;
    h.ben = false;
    h.timer = 0;
  });
  
  gameOver.style.display = "none";
  replayBtn.style.display = "none";
  
  updateHUD();
  spawnHandle = setInterval(spawn, 800);
  timerHandle = setInterval(() => {
    timeLeft--;
    updateHUD();
    if (timeLeft <= 0) endGame();
  }, 1000);
}

function replayGame() {
  startGame();
}

/* INITIALIZE */
Promise.all([loadImage(moleImg), loadImage(benImg)])
  .then(() => {
    updateHUD();
    requestAnimationFrame(tick);
  });

</script>
</body>
</html>
